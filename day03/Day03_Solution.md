# Day3: Terraform Resource Configuration and Lifecycle Management

Greetings Terraform enthusiastic, Hope you like my Day2 Blog. If you not read then click on this link https://github.com/Paisandy/TerraWeek/blob/main/day02/Day02_Solution.md Let's start **Day3**. Seat Back, read and follow my documentation.

## In this blog. we'll explore about
### 1. Create a Terraform configuration file to define a resource of AWS EC2 instance.
### 2. Check state files before running plan and apply commands & Use validate command to validate your tf file for errors and provide the Output generated by each commands.
### 3. Add a provisioner to the configuration file to configure the resource after it is created and use Terraform commands to apply for changes and destroy to remove resources.
### 4. Add lifecycle management configurations to the configuration file to control the creation, modification, and deletion of the resource and use Terraform commands to apply the changes.

## Create a Terraform configuration file to define a resource of AWS EC2 instance.
**Note: Follow my Day1 Blog here is the link https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md and follow how to setup and install it here is the link https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md#how-can-you-install-terraform**

### Install AWS CLI https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
### Follow this Instruction How to setup a AWS CLI https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md#connect-to-aws-cloud

**Now follow the steps:**
**Step-1:** Create a file. In this post I have created a file **"aws_cli.tf"** to add aws cli 
plugins

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/2f1bc6e3-e8ba-427e-8e4d-8d95c18f21d8)

**Step-2:** Create a file **"variable.tf"** to add s3 bucket name, ec2 instance ami, ec2 instance type.

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/586de619-02f1-4e0e-85f2-479fff260f6a)

**Step-3:** Create a **ssh-keygen** before the configuration of vpc, security groups add on.

**Step-4:**   Create a file **"main.tf"** add s3 bucket, configure keypair, vpc and security groups.

1. Give the Provider aws and the region name
```
provider "aws" {
  region = "us-east-1"
}
```

2. Creat a AWS S3 Bucket
```
# creating a aws s3 bucket
resource "aws_s3_bucket" "bucket_demo" {
  bucket = var.aws_bucket
  tags = {
    "Name"        = "Day_teen"
    "Environment" = "Dev"
  }
}
```
**FOLLOW THE TERRAFORM DOCUMENTATION FOR S3 BUCKET https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket**
for bucket. I have used variable. You can see the **"variable.tf** that I have menttioned s3 bucket name.

3. Create a EC2 Key pair
```
   resource "aws_key_pair" "my-key" {
  key_name   = 
  public_key = 
}
```
you can give your own **"key_name"**, "**public_key"**
**FOLLOW THE TERRAFORM DOCUMENTATION FOR EC2 KEY PAIR https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/key_pair**

4. Create a AWS default vpc and assign to the instance and security group
**FOLLOW THE TERRAFORM DOCUMENTATION FOR VPC https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc**

5. Create a AWS security group
```
resource "aws_security_group" "security" {
  name        = "security"
  description = "Allow ssh inbound traffic"
  vpc_id      = aws_default_vpc.default_vpc.id

  ingress {

    description = "TLS from VPC"
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    "Name" = "security"
  }
}
```
Creates a security group resource and sets the name of the security group. Defines an ingress rule to allow SSH traffic on port 22 from any IP.
**FOLLOW THE TERRAFORM DOCUMENTATION FOR SECURITY GROUP https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group**

6. Create a AWS iNSTANCE
```
resource "aws_instance" "instance" {
  key_name        = aws_key_pair.my-key.key_name
  ami             = var.aws_instance
  instance_type   = var.aws_type
  security_groups = [aws_security_group.security.name]
  tags = {
    "Name" = "day-three"
  }
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/4e08f3bf-19fe-48e9-9350-addc28139116)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/692f0934-2d7d-4b44-8691-5cab14eb47f1)

## 2. Check state files before running plan and apply commands & Use validate command to validate your tf file for errors and provide the Output generated by each commands.
Run the below commands in the same directory.
```
terraform init
```
Terraform will download the necessary plugins

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/841529e5-e3e4-4e92-aca3-e55927295eba)

Check Terraform state list
```
terraform state list
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/689884e3-60ad-4ab2-8587-26130c90052a)

## 3. Add a provisioner to the configuration file to configure the resource after it is created and use Terraform commands to apply for changes and destroy to remove resources.

Click in this link https://github.com/Paisandy/TerraWeek/blob/main/day03/Day03_Solution.md#create-a-terraform-configuration-file-to-define-a-resource-of-aws-ec2-instance and follow the steps and check it the plugins, providers and follow the **Terraform Documentations**

After that do
```
terraform fmt
```
```
terraform validate
```
```
terraform plan
```
```
terraform apply
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/d2fd23ed-bf05-4224-8618-806bc4518d37)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/49ebc4ec-b863-4d3e-b11f-adedda426cc9)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/7f46791f-8259-41eb-acd3-cdfa7e6a26b6)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/eb40cab1-f76c-4c0f-be59-42050a3ec7cf)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/ebc82906-ee84-4ef0-9295-1e8d5e3ea53a)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/06197bd0-d74b-4855-bf0c-59a5acf6d6a3)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/132ba498-f8f7-494e-9534-f8d2a0b8e04b)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/c02807e8-b049-404b-aabe-5b075bd349ef)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/9a0a8bde-a13c-4104-bee9-fe72d832c44d)

Finally your AWS EC2 Is Running!!

## 4. Add lifecycle management configurations to the configuration file to control the creation, modification, and deletion of the resource and use Terraform commands to apply the changes.

Lifecycle management in Terraform allows you to control the behavior of your resources throughout their lifecycle, including their creation, modification, and deletion. It provides fine-grained control over when and how resources are replaced or updated, and it's crucial for managing resources safely and efficiently. Here's an overview of Terraform's lifecycle management features:

**1. Create Before Destroy:** By default, Terraform creates a new resource and then destroys the old one when you update a resource. This behavior is known as "create before destroy." It ensures minimal downtime during updates but might not be suitable for all scenarios.

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/53c040f2-3e42-4d0f-98b7-2e8893bf07c8)

**2. Prevent Destroy:** You can use the **"prevent_destroy"** argument to prevent certain resources from being destroyed, providing an extra layer of safety. This is useful for critical resources that should never be deleted accidentally.

```
resource "aws_instance" "instance" {
  key_name        = aws_key_pair.my-key.key_name
  ami             = var.aws_instance
  instance_type   = var.aws_type
  security_groups = [aws_security_group.security.name]
  tags = {
    "Name" = "day-three"
  }

  lifecycle {
    prevent_destroy = true
  }
}
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/3f81900b-b120-4e72-99c8-13e85190ea6c)

```
resource "aws_instance" "instance" {
  key_name        = aws_key_pair.my-key.key_name
  ami             = var.aws_instance
  instance_type   = var.aws_type
  security_groups = [aws_security_group.security.name]
  tags = {
    "Name" = "day-three"
  }

  lifecycle {
    prevent_destroy = false
  }
}
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/31805839-f501-4d01-a556-b997e33f443c)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/cc86aa02-ac30-480e-82dc-bbd0308ff202)

# Conclusion:
You did it! You learned how to use Terraform, See the magic how automation work. Practice it more. Do hands on experience. Will see next blog.
