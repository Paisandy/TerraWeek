# Day3: Terraform Resource Configuration and Lifecycle Management

Greetings Terraform enthusiastic, Hope you like my Day2 Blog. If you not read then click on this link https://github.com/Paisandy/TerraWeek/blob/main/day02/Day02_Solution.md Let's start **Day3**. Seat Back, read and follow my documentation.

## In this blog. we'll explore about
### 1. Create a Terraform configuration file to define a resource of AWS EC2 instance.
### 2. Check state files before running plan and apply commands & Use validate command to validate your tf file for errors and provide the Output generated by each commands.
### 3. Add a provisioner to the configuration file to configure the resource after it is created and use Terraform commands to apply for changes and destroy to remove resources.
### 4. Add lifecycle management configurations to the configuration file to control the creation, modification, and deletion of the resource and use Terraform commands to apply the changes.

## Create a Terraform configuration file to define a resource of AWS EC2 instance.
**Note: Follow my Day1 Blog here is the link https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md and follow how to setup and install it here is the link https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md#how-can-you-install-terraform**

### Install AWS CLI https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
### Follow this Instruction How to setup a AWS CLI https://github.com/Paisandy/TerraWeek/blob/main/day01/Day01_Solution.md#connect-to-aws-cloud

**Now follow the steps:**
**Step-1:** Create a file. In this post I have created a file **"aws_cli.tf"** to add aws cli 
plugins

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/2f1bc6e3-e8ba-427e-8e4d-8d95c18f21d8)

**Step-2:** Create a file **"variable.tf"** to add s3 bucket name, ec2 instance ami, ec2 instance type.

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/586de619-02f1-4e0e-85f2-479fff260f6a)

**Step-3:** Create a **ssh-keygen** before the configuration of vpc, security groups add on.

**Step-4:**   Create a file **"main.tf"** add s3 bucket, configure keypair, vpc and security groups.

1. Give the Provider aws and the region name
```
provider "aws" {
  region = "us-east-1"
}
```

2. Creat a AWS S3 Bucket
```
# creating a aws s3 bucket
resource "aws_s3_bucket" "bucket_demo" {
  bucket = var.aws_bucket
  tags = {
    "Name"        = "Day_teen"
    "Environment" = "Dev"
  }
}
```
**FOLLOW THE TERRAFORM DOCUMENTATION FOR S3 BUCKET https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket**
for bucket. I have used variable. You can see the **"variable.tf** that I have menttioned s3 bucket name.

3. Create a EC2 Key pair
```
   resource "aws_key_pair" "my-key" {
  key_name   = 
  public_key = 
}
```
you can give your own **"key_name"**, "**public_key"**
**FOLLOW THE TERRAFORM DOCUMENTATION FOR EC2 KEY PAIR https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/key_pair**

4. Create a AWS default vpc and assign to the instance and security group
**FOLLOW THE TERRAFORM DOCUMENTATION FOR VPC https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc**

5. Create a AWS security group
```
resource "aws_security_group" "security" {
  name        = "security"
  description = "Allow ssh inbound traffic"
  vpc_id      = aws_default_vpc.default_vpc.id

  ingress {

    description = "TLS from VPC"
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    "Name" = "security"
  }
}
```
Creates a security group resource and sets the name of the security group. Defines an ingress rule to allow SSH traffic on port 22 from any IP.
**FOLLOW THE TERRAFORM DOCUMENTATION FOR SECURITY GROUP https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group**

6. Create a AWS iNSTANCE
```
resource "aws_instance" "instance" {
  key_name        = aws_key_pair.my-key.key_name
  ami             = var.aws_instance
  instance_type   = var.aws_type
  security_groups = [aws_security_group.security.name]
  tags = {
    "Name" = "day-three"
  }
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/4e08f3bf-19fe-48e9-9350-addc28139116)

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/692f0934-2d7d-4b44-8691-5cab14eb47f1)

## 2. Check state files before running plan and apply commands & Use validate command to validate your tf file for errors and provide the Output generated by each commands.
Run the below commands in the same directory.
```
terraform init
```
Terraform will download the necessary plugins

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/841529e5-e3e4-4e92-aca3-e55927295eba)

Check Terraform state list
```
terraform state list
```

![image](https://github.com/Paisandy/TerraWeek/assets/115485972/689884e3-60ad-4ab2-8587-26130c90052a)

## 3. Add a provisioner to the configuration file to configure the resource after it is created and use Terraform commands to apply for changes and destroy to remove resources.

